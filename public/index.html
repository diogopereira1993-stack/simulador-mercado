<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vota√ß√£o - MoneyFlix</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="mobile-body">
    <div id="status-bar" class="status-paused">AGUARDANDO...</div>
    
    <div class="header">
        <h1>LUSI</h1>
        <div id="price-display" class="big-price">100.00</div>
    </div>

    <div class="news-ticker">
        <marquee id="news-text">Bem-vindo ao Simulador de Mercado</marquee>
    </div>

    <div class="controls">
        <button id="btn-buy" class="btn buy" onclick="vote('BUY')">COMPRAR üîº</button>
        <button id="btn-hold" class="btn hold" onclick="vote('HOLD')">MANTER ‚è∏</button>
        <button id="btn-sell" class="btn sell" onclick="vote('SELL')">VENDER üîΩ</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const priceDisplay = document.getElementById('price-display');
        const statusBar = document.getElementById('status-bar');
        const newsText = document.getElementById('news-text');
        
        // Vari√°vel de controlo de spam
        let isCoolingDown = false; 

        socket.on('market-update', (data) => {
            priceDisplay.innerText = data.price + "‚Ç¨";
            newsText.innerText = data.news;
            
            if (data.isPaused) {
                statusBar.innerText = "MERCADO PAUSADO";
                statusBar.className = "status-paused";
                document.body.style.opacity = "0.7";
            } else {
                statusBar.innerText = "MERCADO AO VIVO üî¥";
                statusBar.className = "status-live";
                document.body.style.opacity = "1";
            }
        });

        function vote(action) {
            // 1. SE ESTIVER EM ESPERA, IGNORA O CLIQUE (Anti-Spam)
            if (isCoolingDown) return;

            // 2. Enviar Voto Real
            socket.emit('vote', action);
            
            // 3. Feedback F√≠sico
            if (navigator.vibrate) navigator.vibrate(50);
            
            // 4. Mostrar "VOTO REGISTADO"
            showPopup("VOTO REGISTADO! ‚úÖ");

            // 5. Bloquear bot√µes por 3 segundos
            activateCooldown(3000); 
        }

        function showPopup(text) {
            const popup = document.createElement('div');
            popup.className = 'vote-popup';
            popup.innerText = text;
            document.body.appendChild(popup);

            // Remover o popup automaticamente
            setTimeout(() => {
                popup.style.opacity = '0';
                setTimeout(() => popup.remove(), 300);
            }, 1500);
        }

        function activateCooldown(time) {
            isCoolingDown = true;
            
            // Desativar visualmente todos os bot√µes
            const btns = document.querySelectorAll('.btn');
            btns.forEach(btn => btn.disabled = true);

            // Reativar ap√≥s o tempo definido
            setTimeout(() => {
                isCoolingDown = false;
                btns.forEach(btn => btn.disabled = false);
            }, time);
        }
    </script>
</body>
</html>
